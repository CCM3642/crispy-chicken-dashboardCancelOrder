<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>إدخال البيانات - نظام متابعة الطلبات الملغاة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Tajawal', sans-serif; }
    .btn-primary { background-color: #dc2626; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; }
    .btn-secondary { background-color: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; }
    .btn-success { background-color: #16a34a; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; }
    .form-input { border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem; }
    .form-group { margin-bottom: 1rem; }
    .form-label { display: block; font-weight: 500; margin-bottom: 0.25rem; color: #374151; }
    .section-title { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; color: #1f2937; border-bottom: 2px solid #dc2626; padding-bottom: 0.5rem; }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 5px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transform: translateY(-20px);
      transition: opacity 0.3s, transform 0.3s;
    }
    .notification.show {
      opacity: 1;
      transform: translateY(0);
    }
    .notification.success {
      background-color: #10b981;
    }
    .notification.error {
      background-color: #ef4444;
    }
    .notification.info {
      background-color: #3b82f6;
    }
    .stats-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 0.5rem;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }
    .stats-card:hover {
      transform: translateY(-5px);
    }
    .stats-number {
      font-size: 2rem;
      font-weight: bold;
      margin: 0.5rem 0;
    }
    .stats-label {
      font-size: 0.9rem;
      color: #4b5563;
    }
    .dashboard-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .dashboard-table th, .dashboard-table td {
      border: 1px solid #e5e7eb;
      padding: 0.75rem;
      text-align: center;
    }
    .dashboard-table th {
      background-color: #f9fafb;
      font-weight: 600;
    }
    .dashboard-table tr:nth-child(even) {
      background-color: #f9fafb;
    }
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 1rem;
    }
    .pagination button {
      margin: 0 5px;
      padding: 5px 10px;
      border: 1px solid #ddd;
      background-color: white;
      cursor: pointer;
      border-radius: 3px;
    }
    .pagination button.active {
      background-color: #dc2626;
      color: white;
      border-color: #dc2626;
    }
    .pagination button:hover:not(.active) {
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="bg-red-600 p-4 text-white text-center">
    <h1 class="text-2xl font-bold">نظام متابعة الطلبات الملغاة - Crispy Chicken</h1>
    <p class="text-sm">صفحة إدخال البيانات</p>
  </header>
  
  <main class="max-w-4xl mx-auto p-4">
    <!-- معلومات التقرير -->
    <div class="bg-white rounded-lg shadow p-4 mb-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <h2 class="text-lg font-semibold">إدخال بيانات الطلبات الملغاة</h2>
          <p class="text-sm text-gray-600">التاريخ الميلادي: <span id="gregorianDate" class="font-medium"></span></p>
          <p class="text-sm text-gray-600">التاريخ الهجري: <span id="hijriDate" class="font-medium"></span></p>
        </div>
        <div class="flex flex-wrap gap-2">
          <a href="index.html" class="btn-secondary">
            <i class="fas fa-arrow-left ml-1"></i> العودة للوحة التحكم
          </a>
        </div>
      </div>
    </div>
    
    <!-- نموذج إدخال البيانات -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h3 class="section-title">نموذج إدخال البيانات</h3>
      <form id="orderForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="form-group">
          <label for="brand" class="form-label">العلامة التجارية</label>
          <select id="brand" class="form-input w-full" required>
            <option value="Crispy Chicken">Crispy Chicken</option>
          </select>
        </div>
        <div class="form-group">
          <label for="channel" class="form-label">القناة</label>
          <select id="channel" class="form-input w-full" required>
            <option value="Talabat">Talabat</option>
            <option value="Careem Now">Careem Now</option>
            <option value="Deliveroo">Deliveroo</option>
            <option value="Noon Food">Noon Food</option>
            <option value="Smiles">Smiles</option>
          </select>
        </div>
        <div class="form-group">
          <label for="location" class="form-label">الموقع</label>
          <select id="location" class="form-input w-full" required>
            <option value="Electra">Electra</option>
            <option value="Mouroor">Mouroor</option>
            <option value="Khalydiha">Khalydiha</option>
            <option value="Satwa">Satwa</option>
            <option value="Hamdan">Hamdan</option>
            <option value="Barsha">Barsha</option>
            <option value="Shabiha">Shabiha</option>
          </select>
        </div>
        <div class="form-group">
          <label for="status" class="form-label">الحالة</label>
          <select id="status" class="form-input w-full" required>
            <option value="Order Cancelled">Order Cancelled</option>
            <option value="Order Refunded">Order Refunded</option>
            <option value="Order Disputed">Order Disputed</option>
            <option value="Unanswered">Unanswered</option>
          </select>
        </div>
        <div class="form-group">
          <label for="price" class="form-label">السعر</label>
          <input type="text" id="price" class="form-input w-full" placeholder="AED 0.00" required>
        </div>
        <div class="form-group">
          <label for="orderCount" class="form-label">عدد الطلبات</label>
          <input type="number" id="orderCount" class="form-input w-full" min="1" value="1" required>
        </div>
        <div class="form-group md:col-span-2">
          <button type="submit" class="btn-primary w-full">
            <i class="fas fa-plus ml-1"></i> إضافة الطلب
          </button>
        </div>
      </form>
    </div>
    
    <!-- إحصائيات سريعة -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="stats-card">
        <i class="fas fa-clipboard-list text-2xl text-red-500"></i>
        <div class="stats-number" id="totalOrdersStat">0</div>
        <div class="stats-label">إجمالي الطلبات</div>
      </div>
      <div class="stats-card">
        <i class="fas fa-ban text-2xl text-red-500"></i>
        <div class="stats-number" id="cancelledOrdersStat">0</div>
        <div class="stats-label">طلبات ملغاة</div>
      </div>
      <div class="stats-card">
        <i class="fas fa-undo text-2xl text-blue-500"></i>
        <div class="stats-number" id="refundedOrdersStat">0</div>
        <div class="stats-label">طلبات مستردة</div>
      </div>
      <div class="stats-card">
        <i class="fas fa-exclamation-triangle text-2xl text-yellow-500"></i>
        <div class="stats-number" id="pendingOrdersStat">0</div>
        <div class="stats-label">طلبات عالقة</div>
      </div>
    </div>
    
    <!-- الجدول -->
    <div class="bg-white rounded-lg shadow p-4">
      <h3 class="section-title">آخر الطلبات المدخلة</h3>
      <div class="overflow-x-auto">
        <table id="reportTable" class="w-full border text-center text-sm">
          <thead class="bg-red-100">
            <tr>
              <th class="border px-2 py-1">#</th>
              <th class="border px-2 py-1">العلامة التجارية</th>
              <th class="border px-2 py-1">القناة</th>
              <th class="border px-2 py-1">الموقع</th>
              <th class="border px-2 py-1">الحالة</th>
              <th class="border px-2 py-1">السعر</th>
              <th class="border px-2 py-1">عدد الطلبات</th>
              <th class="border px-2 py-1">التاريخ</th>
              <th class="border px-2 py-1">الإجراءات</th>
            </tr>
          </thead>
          <tbody id="reportBody">
            <!-- سيتم تحميل الصفوف من البيانات المدخلة -->
          </tbody>
        </table>
      </div>
      <div class="pagination" id="pagination">
        <!-- سيتم تحميل أزرار التصفح هنا -->
      </div>
    </div>
  </main>
  
  <script>
    // ---- DATA STORAGE ----
    let orders = [];
    let currentPage = 1;
    const ordersPerPage = 15;
    
    // ---- INITIALIZE ----
    window.addEventListener('DOMContentLoaded', init);
    
    function init() {
      // عرض التواريخ
      updateDates();
      
      // تحميل البيانات من التخزين المحلي
      loadData();
      
      // إعداد نموذج الإدخال
      document.getElementById('orderForm').addEventListener('submit', handleFormSubmit);
      
      // تحديث الإحصائيات وعرض الطلبات
      updateGeneralStats();
      displayOrders();
    }
    
    // ---- UPDATE DATES ----
    function updateDates() {
      const now = new Date();
      
      // التاريخ الميلادي
      document.getElementById('gregorianDate').textContent = now.toLocaleDateString('ar-SA');
      
      // التاريخ الهجري (تقريبي)
      const hijriDate = new Intl.DateTimeFormat('ar-SA', {
        calendar: 'islamic',
        day: 'numeric',
        month: 'long',
        year: 'numeric'
      }).format(now);
      document.getElementById('hijriDate').textContent = hijriDate;
    }
    
    // ---- LOAD DATA ----
    function loadData() {
      const savedData = localStorage.getItem('cancelledOrders');
      if (savedData) {
        orders = JSON.parse(savedData);
      }
    }
    
    // ---- SAVE DATA ----
    function saveData() {
      localStorage.setItem('cancelledOrders', JSON.stringify(orders));
    }
    
    // ---- HANDLE FORM SUBMIT ----
    function handleFormSubmit(e) {
      e.preventDefault();
      
      const order = {
        id: Date.now(),
        brand: document.getElementById('brand').value,
        channel: document.getElementById('channel').value,
        location: document.getElementById('location').value,
        status: document.getElementById('status').value,
        price: document.getElementById('price').value,
        orderCount: parseInt(document.getElementById('orderCount').value),
        date: new Date().toISOString()
      };
      
      orders.push(order);
      saveData();
      displayOrders();
      updateGeneralStats();
      
      // إعادة تعيين النموذج
      document.getElementById('orderForm').reset();
      document.getElementById('orderCount').value = 1;
      
      // إظهار رسالة نجاح
      showNotification('تمت إضافة الطلب بنجاح', 'success');
    }
    
    // ---- DISPLAY ORDERS ----
    function displayOrders() {
      const tbody = document.getElementById('reportBody');
      tbody.innerHTML = '';
      
      // حساب الصفحات
      const totalPages = Math.ceil(orders.length / ordersPerPage);
      const startIndex = (currentPage - 1) * ordersPerPage;
      const endIndex = startIndex + ordersPerPage;
      const paginatedOrders = orders.slice(startIndex, endIndex);
      
      // عرض الطلبات في الصفحة الحالية
      paginatedOrders.forEach((order, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="border px-2 py-1">${startIndex + index + 1}</td>
          <td class="border px-2 py-1">${order.brand}</td>
          <td class="border px-2 py-1">${order.channel}</td>
          <td class="border px-2 py-1">${order.location}</td>
          <td class="border px-2 py-1">${order.status}</td>
          <td class="border px-2 py-1">${order.price}</td>
          <td class="border px-2 py-1">${order.orderCount}</td>
          <td class="border px-2 py-1">${new Date(order.date).toLocaleDateString('ar-SA')}</td>
          <td class="border px-2 py-1">
            <button onclick="deleteOrder(${order.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      
      // تحديث أزرار التصفح
      updatePagination(totalPages);
    }
    
    // ---- UPDATE PAGINATION ----
    function updatePagination(totalPages) {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      
      // زر السابق
      const prevButton = document.createElement('button');
      prevButton.textContent = 'السابق';
      prevButton.disabled = currentPage === 1;
      prevButton.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          displayOrders();
        }
      };
      pagination.appendChild(prevButton);
      
      // أرقام الصفحات
      for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement('button');
        pageButton.textContent = i;
        pageButton.className = i === currentPage ? 'active' : '';
        pageButton.onclick = () => {
          currentPage = i;
          displayOrders();
        };
        pagination.appendChild(pageButton);
      }
      
      // زر التالي
      const nextButton = document.createElement('button');
      nextButton.textContent = 'التالي';
      nextButton.disabled = currentPage === totalPages;
      nextButton.onclick = () => {
        if (currentPage < totalPages) {
          currentPage++;
          displayOrders();
        }
      };
      pagination.appendChild(nextButton);
    }
    
    // ---- UPDATE GENERAL STATS ----
    function updateGeneralStats() {
      const totalOrders = orders.reduce((sum, order) => sum + order.orderCount, 0);
      const cancelledOrders = orders.filter(order => order.status === 'Order Cancelled').reduce((sum, order) => sum + order.orderCount, 0);
      const refundedOrders = orders.filter(order => order.status === 'Order Refunded').reduce((sum, order) => sum + order.orderCount, 0);
      const pendingOrders = orders.filter(order => order.status === 'Order Disputed' || order.status === 'Unanswered').reduce((sum, order) => sum + order.orderCount, 0);
      
      document.getElementById('totalOrdersStat').textContent = totalOrders;
      document.getElementById('cancelledOrdersStat').textContent = cancelledOrders;
      document.getElementById('refundedOrdersStat').textContent = refundedOrders;
      document.getElementById('pendingOrdersStat').textContent = pendingOrders;
    }
    
    // ---- DELETE ORDER ----
    function deleteOrder(id) {
      if (confirm('هل تريد حذف هذا الطلب؟')) {
        orders = orders.filter(order => order.id !== id);
        saveData();
        displayOrders();
        updateGeneralStats();
        showNotification('تم حذف الطلب بنجاح', 'success');
      }
    }
    
    // ---- SHOW NOTIFICATION ----
    function showNotification(message, type) {
      // إزالة أي إشعارات موجودة
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notification => notification.remove());
      
      // إنشاء إشعار جديد
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // إظهار الإشعار
      setTimeout(() => {
        notification.classList.add('show');
      }, 10);
      
      // إخفاء الإشعار بعد 3 ثواني
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 3000);
    }
  </script>
</body>
</html>
